{"ast":null,"code":"import _regeneratorRuntime from\"/home/iheb/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/iheb/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/iheb/Desktop/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useEffect,useState}from'react';import{Link,useHistory}from'react-router-dom';import CheckoutProduct from'./CheckoutProduct';import{useStateValue}from'./StateProvider';import'./Payment.css';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import CurrencyFormat from'react-currency-format';import axios from\"./axios\";import{db}from\"./firebase\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,total=_useStateValue2$.total,dispatch=_useStateValue2[1];var stripe=useStripe();var elements=useElements();var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),porcessing=_useState4[0],setPorcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'post',url:\"/payments/create?total=\".concat(total*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log('the sec',clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setPorcessing(true);_context2.next=4;return stripe.comfirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;db.collection('users').doc(user===null||user===void 0?void 0:user.uid).collection('orders').set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setPorcessing(false);dispatch({type:'EMPTY_BASKET'});history.replaceState('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handlechange=function handlechange(event){setDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment__container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"payment__title\",children:[/*#__PURE__*/_jsx(\"h4\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__adress\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review Items and delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handlechange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total: \",total,\"$ \"]});},decimalScale:2,value:0,displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{disabled:porcessing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:porcessing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["/home/iheb/Desktop/amazon-clone/src/Payment.js"],"names":["React","useEffect","useState","Link","useHistory","CheckoutProduct","useStateValue","CardElement","useStripe","useElements","CurrencyFormat","axios","db","Payment","basket","user","total","dispatch","stripe","elements","history","succeeded","setSucceeded","porcessing","setPorcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","comfirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","set","amount","created","type","replaceState","payload","handlechange","empty","message","length","email","map","item","id","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { Link, useHistory } from 'react-router-dom';\nimport CheckoutProduct from './CheckoutProduct';\nimport { useStateValue } from './StateProvider';\nimport './Payment.css'\nimport { CardElement , useStripe ,useElements } from '@stripe/react-stripe-js';\nimport CurrencyFormat from 'react-currency-format';\nimport axios from \"./axios\";\nimport {db} from \"./firebase\"\n\nfunction Payment() {\n    const[{basket,user,total},dispatch]=useStateValue();\n    const stripe=useStripe();\n    const elements=useElements();\n    const history = useHistory();\n    const [succeeded,setSucceeded] =useState(false);\n    const [porcessing,setPorcessing] =useState(\"\");\n    const [error, setError] = useState(null);\n    const [disabled, setDisabled] = useState(true);\n    const [clientSecret, setClientSecret] = useState(true);\n    useEffect(() => {\n        const getClientSecret = async () =>{\n            const response = await axios({\n                method: 'post',\n                url: `/payments/create?total=${total * 100}`\n            });\n            setClientSecret(response.data.clientSecret)\n        }\n        getClientSecret();\n    }, [basket])\n\n    console.log('the sec', clientSecret)\n    const handleSubmit = async (event) =>{\n        event.preventDefault();\n        setPorcessing(true);\n        const payload = await stripe.comfirmCardPayment(clientSecret,{\n            payment_method:{\n                card: elements.getElement(CardElement)\n            }\n        }).then(({paymentIntent}) =>{\n            db.collection('users').doc(user?.uid).collection('orders').set({\n                basket:basket,\n                amount: paymentIntent.amount,\n                created: paymentIntent.created\n            })\n            setSucceeded(true);\n            setError(null);\n            setPorcessing(false);\n            dispatch({type: 'EMPTY_BASKET'})\n            history.replaceState('/orders');\n        })\n    }\n    const handlechange =event =>{\n        setDisabled(event.empty);\n        setError(event.error ? event.error.message : \"\");\n    }\n    return (\n        <div className=\"payment\">\n            <div className=\"payment__container\">\n                <h1>Checkout ({\n                    <Link to=\"/checkout\">{basket?.length} items</Link>\n                    })\n                </h1>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h4>{user?.email}</h4>\n                        <h3>Delivery Address</h3>\n                    </div>\n                    <div className=\"payment__adress\">\n                        <input type=\"text\" />\n                    </div>\n                </div>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Review Items and delivery</h3>\n                    </div>\n                    <div className='payment__items'>\n                        {basket.map((item)=>{\n                            return(\n                                <CheckoutProduct id={item.id} title={item.title} image={item.image} price={item.price} rating={item.rating}  />\n                            )\n                        })}\n                    </div>\n                </div>\n                <div className=\"payment__section\">\n                    <div className=\"payment__title\">\n                        <h3>Payment Method</h3>\n                    </div>\n                    <div className=\"payment__details\">\n                        <form onSubmit={handleSubmit}>\n                            <CardElement onChange={handlechange} />\n                            <div className='payment__priceContainer'>\n                            <CurrencyFormat\n                                renderText={(value) =>(\n                                <h3>Order Total: {total}$ </h3>\n                                )}\n                                decimalScale={2}\n                                value={0}\n                                displayType={\"text\"}\n                                thousandSeparator={true}\n                                prefix={\"$\"}\n                                />\n                                <button disabled={porcessing ||disabled ||succeeded}><span>\n                                    {porcessing ? <p>Processing</p> : \"Buy Now\"}\n                                    </span></button>\n                            </div>\n\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default Payment\n"]},"metadata":{},"sourceType":"module"}